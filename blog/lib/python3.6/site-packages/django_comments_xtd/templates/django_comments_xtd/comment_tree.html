{% load l10n %}
{% load i18n %}
{% load comments %}
{% load comments_xtd %}
{% for item in comments %}
<div class="pinglun">
    <li class="comment-item">
        <div class="commentator-avatar">
            <a href="#" name="c{{ item.comment.id }}" >
                {{ item.comment.user_email|email_gravatar }}
            </a>
        </div>
        <div class="commentator-comment">
            <div class="comment-top">
                <div class="author-name">
                    <strong>
                        {% if item.comment.url and not item.comment.is_removed %}
                        <a href="{{ item.comment.url }}" target="_new">
                            {% endif %}
                            {{ item.comment.name }}

                            {% if item.comment.url %}
                        </a>
                        {% endif %}

                        {% if children_flag %}
                        <a href="https://www.bgdnuidxv.com" target="_new">
                        <span class="children-father">
                            @{{ father }}
                        </span>
                        </a>
                        {% endif %}

                        {% if item.comment.user and item.comment.user|has_permission:"django_comments.can_moderate" %}&nbsp;
                        <span class="comment-admin-badge badge-secondary">
                            <i class="fas fa-chess-king"></i>博主
                        </span>
                        {% endif %}
                    </strong>
                </div>
                <div class="author-flag">
                    {% if not item.comment.is_removed %}
                    {% if perms.comments.can_moderate %}
                    {% if item.flagged_count %}
                    <span class="comment-badge badge-primary text-white cfb-counter" title="{% blocktrans count counter=item.flagged_count %}此条评论已被人举报 等待管理员处理.{% plural %}{{ counter }} 名用户举报此评论.{% endblocktrans %}">{{ item.flagged_count }}</span>
                    {% endif %}
                    {% endif %}
                    {% if allow_flagging and item.flagged %}
                    <i class="fas fa-flag text-danger" title="已举报"></i>
                    {% elif allow_flagging %}
                    <a href="{% url 'comments-flag' item.comment.pk %}">
                        <i class="fas fa-flag" title="举报"></i></a>
                    {% endif %}
                    {% if perms.comments.can_moderate %}
                    <a href="{% url 'comments-delete' item.comment.pk %}">
                        <i class="fas fa-trash-alt" title="删除"></i></a>
                    {% endif %}
                    {% endif %}
                </div>
            </div>
            <div class="comment-chat">
                <div class="comment-comment">
                    {% if item.comment.is_removed %}
                    <p class="text-muted{% if not allow_feedback and not item.comment.allow_thread %} pb-3{% endif %}"><em>此评论已被移除</em></p>
                    {% else %}
                    <div class="content{% if not allow_feedback and not item.comment.allow_thread %} pb-3{% endif %}">
                        {% include "includes/django_comments_xtd/comment_content.html" with content=item.comment.comment %}
                    </div>
                </div>
            </div>
            <div class="comment-below">
                <div class="author-time">
                    {{ item.comment.submit_date }}
                </div>
                <div class="author-reply">
                    {% if item.comment.allow_thread and not item.comment.is_removed %}
                    <a class="small mutedlink" href="{{ item.comment.get_reply_url }}">回复</a>
                    {% endif %}
                    {% endif %}
                </div>
                <div class="author-like">
                    {% include "includes/django_comments_xtd/user_feedback.html" %}
                </div>
            </div>
        </div>
    </li>
    {% if not item.comment.is_removed and item.children %}
    <div class="children">
        {% render_xtdcomment_tree with comments=item.children father=item.comment.name children_flag=1 %}
    </div>
    {% endif %}
</div>
{% endfor %}
