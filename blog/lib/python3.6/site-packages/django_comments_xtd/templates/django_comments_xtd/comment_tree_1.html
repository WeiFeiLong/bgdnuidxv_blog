{% load l10n %}
{% load i18n %}
{% load comments %}
{% load comments_xtd %}
{% for item in comments %}
<div class="pinglun">
    <li class="comment-item">
        <div class="commentator-avatar">
            <a href="#" name="c{{ item.comment.id }}" >
                {{ item.comment.user_email|email_gravatar }}
            </a>
        </div>
        <div class="commentator-comment">
            <span class="commentator-name">
                <strong class="author-name">
<!--                    <a href="#" target="_blank" rel="external nofollow" class="url">  -->
                        {{ item.comment.submit_date|localize }}&nbsp;-&nbsp;
                        {% if item.comment.url and not item.comment.is_removed %}
                        <a href="{{ item.comment.url }}" target="_new">
                            {% endif %}
                            {{ item.comment.name }}
                            {% if item.comment.url %}
                        </a>
                        {% endif %}
                        {% if item.comment.user and item.comment.user|has_permission:"django_comments.can_moderate" %}&nbsp;
                        <span class="comment-admin-badge badge-secondary">
                            <i class="fas fa-chess-king"></i>
                            博主
                        </span>
                        {% endif %}&nbsp;&nbsp;
<!--                        <a class="permalink" title="{% trans '评论永久链接' %}" href="{% get_comment_permalink item.comment %}">-->
<!--                            ¶-->
<!--                        </a>-->
<!--                    </a>-->
                </strong>
            </span>
            <span>    <!--人名和标记-->
                {% if not item.comment.is_removed %}
                    {% if perms.comments.can_moderate %}
                        {% if item.flagged_count %}
                            <span class="comment-badge badge-primary text-white cfb-counter" title="{% blocktrans count counter=item.flagged_count %}此条评论已被人举报 等待管理员处理.{% plural %}{{ counter }} 名用户举报此评论.{% endblocktrans %}">{{ item.flagged_count }}</span>
                        {% endif %}
                    {% endif %}
                    {% if allow_flagging and item.flagged %}
                        <i class="fas fa-flag text-danger" title="已举报"></i>
                        {% elif allow_flagging %}
                        <a href="{% url 'comments-flag' item.comment.pk %}">
                            <i class="fas fa-flag" title="评论标记"></i></a>
                    {% endif %}
                    {% if perms.comments.can_moderate %}
                        <a href="{% url 'comments-delete' item.comment.pk %}">
                            <i class="fas fa-trash-alt" title="删除评论"></i></a>
                    {% endif %}
                {% endif %}
            </span>
            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
            <div class="comment-chat">
                <div class="comment-comment">
                    {% if item.comment.is_removed %}   <!--评论被删-->
                    <p class="text-muted{% if not allow_feedback and not item.comment.allow_thread %} pb-3{% endif %}"><em>{% trans "此评论已被移除" %}</em></p>
                    {% else %}  <!--评论还在-->
                    <div class="content{% if not allow_feedback and not item.comment.allow_thread %} pb-3{% endif %}">
                        {% include "includes/django_comments_xtd/comment_content.html" with content=item.comment.comment %}
                    </div>
                </div>
            </div>
        </div>
        {% if allow_feedback %}   <!--点赞-->
        {% include "includes/django_comments_xtd/user_feedback.html" %}
        {% endif %}
        {% if item.comment.allow_thread and not item.comment.is_removed %}
        {% if allow_feedback %}&nbsp;&nbsp;<span class="text-muted">&bull;</span>&nbsp;&nbsp;{% endif %}<a class="small mutedlink" href="{{ item.comment.get_reply_url }}">{% trans "回复" %}</a>
        {% endif %}
        {% endif %}
    </li>
    {% if not item.comment.is_removed and item.children %}
    <div class="children">
    {% render_xtdcomment_tree with comments=item.children %}
    </div>
    {% endif %}
</div>
{% endfor %}
